{"ast":null,"code":"var Class = require(\"o3\").Class,\n    abstractMethod = require(\"o3\").abstractMethod,\n    eachCombination = require(\"u3\").eachCombination,\n    cache = require(\"u3\").cache,\n    capability = require(\"capability\");\n\nvar AbstractFrameStringSource = Class(Object, {\n  prototype: {\n    captureFrameStrings: function (frameShifts) {\n      var error = this.createError();\n      frameShifts.unshift(this.captureFrameStrings);\n      frameShifts.unshift(this.createError);\n      var capturedFrameStrings = this.getFrameStrings(error);\n      var frameStrings = capturedFrameStrings.slice(frameShifts.length),\n          functionValues = [];\n\n      if (capability(\"arguments.callee.caller\")) {\n        var capturedFunctionValues = [this.createError, this.captureFrameStrings];\n\n        try {\n          var aCaller = arguments.callee;\n\n          while (aCaller = aCaller.caller) capturedFunctionValues.push(aCaller);\n        } catch (useStrictError) {}\n\n        functionValues = capturedFunctionValues.slice(frameShifts.length);\n      }\n\n      return {\n        frameStrings: frameStrings,\n        functionValues: functionValues\n      };\n    },\n    getFrameStrings: function (error) {\n      var message = error.message || \"\";\n      var name = error.name || \"\";\n      var stackString = this.getStackString(error);\n      if (stackString === undefined) return;\n      var stackStringChunks = stackString.split(\"\\n\");\n      var fromPosition = 0;\n      var toPosition = stackStringChunks.length;\n      if (this.hasHeader) fromPosition += name.split(\"\\n\").length + message.split(\"\\n\").length - 1;\n      if (this.hasFooter) toPosition -= 1;\n      return stackStringChunks.slice(fromPosition, toPosition);\n    },\n    createError: abstractMethod,\n    getStackString: abstractMethod,\n    hasHeader: undefined,\n    hasFooter: undefined\n  }\n});\nvar FrameStringSourceCalibrator = Class(Object, {\n  prototype: {\n    calibrateClass: function (FrameStringSource) {\n      return this.calibrateMethods(FrameStringSource) && this.calibrateEnvelope(FrameStringSource);\n    },\n    calibrateMethods: function (FrameStringSource) {\n      try {\n        eachCombination([[function (message) {\n          return new Error(message);\n        }, function (message) {\n          try {\n            throw new Error(message);\n          } catch (error) {\n            return error;\n          }\n        }], [function (error) {\n          return error.stack;\n        }, function (error) {\n          return error.stacktrace;\n        }]], function (createError, getStackString) {\n          if (getStackString(createError())) throw {\n            getStackString: getStackString,\n            createError: createError\n          };\n        });\n      } catch (workingImplementation) {\n        Class.merge.call(FrameStringSource, {\n          prototype: workingImplementation\n        });\n        return true;\n      }\n\n      return false;\n    },\n    calibrateEnvelope: function (FrameStringSource) {\n      var getStackString = FrameStringSource.prototype.getStackString;\n      var createError = FrameStringSource.prototype.createError;\n      var calibratorStackString = getStackString(createError(\"marker\"));\n      var calibratorFrameStrings = calibratorStackString.split(\"\\n\");\n      Class.merge.call(FrameStringSource, {\n        prototype: {\n          hasHeader: /marker/.test(calibratorFrameStrings[0]),\n          hasFooter: calibratorFrameStrings[calibratorFrameStrings.length - 1] === \"\"\n        }\n      });\n      return true;\n    }\n  }\n});\nmodule.exports = {\n  getClass: cache(function () {\n    var FrameStringSource;\n    if (FrameStringSource) return FrameStringSource;\n    FrameStringSource = Class(AbstractFrameStringSource, {});\n    var calibrator = new FrameStringSourceCalibrator();\n    if (!calibrator.calibrateClass(FrameStringSource)) throw new Error(\"Cannot read Error.prototype.stack in this environment.\");\n    return FrameStringSource;\n  }),\n  getInstance: cache(function () {\n    var FrameStringSource = this.getClass();\n    var instance = new FrameStringSource();\n    return instance;\n  })\n};","map":{"version":3,"names":["Class","require","abstractMethod","eachCombination","cache","capability","AbstractFrameStringSource","Object","prototype","captureFrameStrings","frameShifts","error","createError","unshift","capturedFrameStrings","getFrameStrings","frameStrings","slice","length","functionValues","capturedFunctionValues","aCaller","arguments","callee","caller","push","useStrictError","message","name","stackString","getStackString","undefined","stackStringChunks","split","fromPosition","toPosition","hasHeader","hasFooter","FrameStringSourceCalibrator","calibrateClass","FrameStringSource","calibrateMethods","calibrateEnvelope","Error","stack","stacktrace","workingImplementation","merge","call","calibratorStackString","calibratorFrameStrings","test","module","exports","getClass","calibrator","getInstance","instance"],"sources":["C:/Projects/node_modules/error-polyfill/lib/non-v8/FrameStringSource.js"],"sourcesContent":["var Class = require(\"o3\").Class,\r\n    abstractMethod = require(\"o3\").abstractMethod,\r\n    eachCombination = require(\"u3\").eachCombination,\r\n    cache = require(\"u3\").cache,\r\n    capability = require(\"capability\");\r\n\r\nvar AbstractFrameStringSource = Class(Object, {\r\n    prototype: {\r\n        captureFrameStrings: function (frameShifts) {\r\n            var error = this.createError();\r\n            frameShifts.unshift(this.captureFrameStrings);\r\n            frameShifts.unshift(this.createError);\r\n            var capturedFrameStrings = this.getFrameStrings(error);\r\n\r\n            var frameStrings = capturedFrameStrings.slice(frameShifts.length),\r\n                functionValues = [];\r\n\r\n            if (capability(\"arguments.callee.caller\")) {\r\n                var capturedFunctionValues = [\r\n                    this.createError,\r\n                    this.captureFrameStrings\r\n                ];\r\n                try {\r\n                    var aCaller = arguments.callee;\r\n                    while (aCaller = aCaller.caller)\r\n                        capturedFunctionValues.push(aCaller);\r\n                }\r\n                catch (useStrictError) {\r\n                }\r\n                functionValues = capturedFunctionValues.slice(frameShifts.length);\r\n            }\r\n            return {\r\n                frameStrings: frameStrings,\r\n                functionValues: functionValues\r\n            };\r\n        },\r\n        getFrameStrings: function (error) {\r\n            var message = error.message || \"\";\r\n            var name = error.name || \"\";\r\n            var stackString = this.getStackString(error);\r\n            if (stackString === undefined)\r\n                return;\r\n            var stackStringChunks = stackString.split(\"\\n\");\r\n            var fromPosition = 0;\r\n            var toPosition = stackStringChunks.length;\r\n            if (this.hasHeader)\r\n                fromPosition += name.split(\"\\n\").length + message.split(\"\\n\").length - 1;\r\n            if (this.hasFooter)\r\n                toPosition -= 1;\r\n            return stackStringChunks.slice(fromPosition, toPosition);\r\n        },\r\n        createError: abstractMethod,\r\n        getStackString: abstractMethod,\r\n        hasHeader: undefined,\r\n        hasFooter: undefined\r\n    }\r\n});\r\n\r\nvar FrameStringSourceCalibrator = Class(Object, {\r\n    prototype: {\r\n        calibrateClass: function (FrameStringSource) {\r\n            return this.calibrateMethods(FrameStringSource) && this.calibrateEnvelope(FrameStringSource);\r\n        },\r\n        calibrateMethods: function (FrameStringSource) {\r\n            try {\r\n                eachCombination([[\r\n                    function (message) {\r\n                        return new Error(message);\r\n                    },\r\n                    function (message) {\r\n                        try {\r\n                            throw new Error(message);\r\n                        }\r\n                        catch (error) {\r\n                            return error;\r\n                        }\r\n                    }\r\n                ], [\r\n                    function (error) {\r\n                        return error.stack;\r\n                    },\r\n                    function (error) {\r\n                        return error.stacktrace;\r\n                    }\r\n                ]], function (createError, getStackString) {\r\n                    if (getStackString(createError()))\r\n                        throw {\r\n                            getStackString: getStackString,\r\n                            createError: createError\r\n                        };\r\n                });\r\n            } catch (workingImplementation) {\r\n                Class.merge.call(FrameStringSource, {\r\n                    prototype: workingImplementation\r\n                });\r\n                return true;\r\n            }\r\n            return false;\r\n        },\r\n        calibrateEnvelope: function (FrameStringSource) {\r\n            var getStackString = FrameStringSource.prototype.getStackString;\r\n            var createError = FrameStringSource.prototype.createError;\r\n            var calibratorStackString = getStackString(createError(\"marker\"));\r\n            var calibratorFrameStrings = calibratorStackString.split(\"\\n\");\r\n            Class.merge.call(FrameStringSource, {\r\n                prototype: {\r\n                    hasHeader: /marker/.test(calibratorFrameStrings[0]),\r\n                    hasFooter: calibratorFrameStrings[calibratorFrameStrings.length - 1] === \"\"\r\n                }\r\n            });\r\n            return true;\r\n        }\r\n    }\r\n});\r\n\r\n\r\nmodule.exports = {\r\n    getClass: cache(function () {\r\n        var FrameStringSource;\r\n        if (FrameStringSource)\r\n            return FrameStringSource;\r\n        FrameStringSource = Class(AbstractFrameStringSource, {});\r\n        var calibrator = new FrameStringSourceCalibrator();\r\n        if (!calibrator.calibrateClass(FrameStringSource))\r\n            throw new Error(\"Cannot read Error.prototype.stack in this environment.\");\r\n        return FrameStringSource;\r\n    }),\r\n    getInstance: cache(function () {\r\n        var FrameStringSource = this.getClass();\r\n        var instance = new FrameStringSource();\r\n        return instance;\r\n    })\r\n};"],"mappings":"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"},"metadata":{},"sourceType":"script"}